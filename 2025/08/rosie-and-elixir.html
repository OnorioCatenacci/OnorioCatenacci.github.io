<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>Rosie And Elixir</title>
    <meta name="description" content="I've been working on writing PEG expressions with Rosie Pattern Language to help people to search Elixir code bases for certain things. Very preliminary but I did want to share what I've got so far....">
    <meta name="author"      content="Onorio Catenacci">
    <meta name="keywords"    content="Pattern Matching, Elixir, Searching Code">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/favicon.ico">
    <link rel="canonical" href="https://onor.io/2025\08\rosie-and-elixir.html">
    <link rel="next" href="/2025\07\stop-helping-me-ai.html">

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <!-- Feeds -->
    <link rel="alternate" type="application/atom+xml"
          href="/feeds\all.atom.xml" title="Atom Feed">
    <link rel="alternate" type="application/rss+xml"
          href="/feeds\all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-xxxxx', 'auto');
      ga('send', 'pageview');
    </script>
  </head>
  <body>

    <!-- A standard Twitter Bootstrap nav bar -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <div class="container">

      <a href="/index.html" class="navbar-brand">onor.io</a>

      <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
              data-target="#navbar_collapse" aria-controls="navbar_collapse"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbar_collapse">
          <ul class="navbar-nav mr-auto">


            <li class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b>
              </a>

              <div class="dropdown-menu">
                <a class="dropdown-item" href="/tags\AI.html">AI</a><a class="dropdown-item" href="/tags\Books.html">Books</a><a class="dropdown-item" href="/tags\CodingRecipes.html">CodingRecipes</a><a class="dropdown-item" href="/tags\Conferences.html">Conferences</a><a class="dropdown-item" href="/tags\CrossPlatform.html">CrossPlatform</a><a class="dropdown-item" href="/tags\DetroitTechWatch.html">DetroitTechWatch</a><a class="dropdown-item" href="/tags\Elixir.html">Elixir</a><a class="dropdown-item" href="/tags\History.html">History</a><a class="dropdown-item" href="/tags\HtDP.html">HtDP</a><a class="dropdown-item" href="/tags\Humor.html">Humor</a><a class="dropdown-item" href="/tags\Intro.html">Intro</a><a class="dropdown-item" href="/tags\Learning.html">Learning</a><a class="dropdown-item" href="/tags\Meetups.html">Meetups</a><a class="dropdown-item" href="/tags\Newsletters.html">Newsletters</a><a class="dropdown-item" href="/tags\Opinion.html">Opinion</a><a class="dropdown-item" href="/tags\Pattern-Matching.html">Pattern Matching</a><a class="dropdown-item" href="/tags\Personal.html">Personal</a><a class="dropdown-item" href="/tags\Podcasts.html">Podcasts</a><a class="dropdown-item" href="/tags\Politics.html">Politics</a><a class="dropdown-item" href="/tags\Racket.html">Racket</a><a class="dropdown-item" href="/tags\Scripting.html">Scripting</a><a class="dropdown-item" href="/tags\Searching-Code.html">Searching Code</a><a class="dropdown-item" href="/tags\SoftwareEngineering.html">SoftwareEngineering</a><a class="dropdown-item" href="/tags\Writing.html">Writing</a>
              </div>
            </li>

            <li>
              <a class="nav-link" href="/About.html">About</a>
            </li> 

            <li class="nav-item">
              <a class="nav-link" href="/feeds\all.atom.xml">Atom</a>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="/feeds\all.rss.xml">RSS</a>
            </li>
          </ul>
      </div>

      </div>
    </nav>


    <div class="container">
      <div class="row">

        <!-- Main column -->
        <div id="content" class="col-md-12">





          <article>
    <header>
        <h1>Rosie And Elixir</h1>
        <p class="date-and-tags">
<time datetime="2025-08-01" pubdate="true">2025-08-01</time> :: <span class="tags"><a href="/tags\Pattern-Matching.html">Pattern Matching</a>, <a href="/tags\Elixir.html">Elixir</a>, <a href="/tags\Searching-Code.html">Searching Code</a></span></p>
        <p class="authors">By: <span class="authors">Onorio Catenacci</span></p>
    </header>

<p>I&rsquo;ve been working on writing <a href="https://en.wikipedia.org/wiki/Parsing_expression_grammar">PEG</a> expressions with <a href="https://gitlab.com/rosie-pattern-language/rosie">Rosie Pattern Language</a> to help people to search Elixir code bases for certain things. Very preliminary but I did want to share what I&rsquo;ve got so far.</p>
<!-- more-->

<p>A few years ago I gave a talk at the Elixir Conference about searching code. One of the last techniques I covered was using Dr. Jamie Jenning&rsquo;s excellent Rosie Pattern Language. I think of Rosie&rsquo;s implementation of parsing expression grammars as a large step forward from writing regular expressions. Dr. Jennings has added lots of nice features to enable writing and testing PEG&rsquo;s. I&rsquo;m currently thinking of using Rosie as a means of prototyping PEG experessions and then implementing them in &mdash; oh maybe Rust or Racket. Best of both worlds&mdash;get the speed of a systems language and the ease of use of Rosie to build/test my expressions.</p>

<p>So I&rsquo;ve been slowly building up a file of patterns for Elixir. Here&rsquo;s the code as it stands right now:</p>

<pre><code>-- 
-- Elixir Patterns
--
-- This file contains Rosie Pattern Language (RPL) patterns that can be used to match Elixir language constructs.

-- 
-- LICENSE: MIT License (https://opensource.org/licenses/mit-license.html)
-- AUTHOR: Onorio Catenacci
-- 11 July 2025

rpl 1.3
package elixir

grammar
   comment_char = "#"
   string_interpolation = "#{"
   comment_text = .+ 
in
   comment = {comment_char &amp; ! string_interpolation ~ comment_text} 
end

-- test comment accepts "# this is my test"
-- test comment accepts "#Jammed right up against the octothorpe"
-- test comment accepts "## this is a style of comment I've seen before"
-- test comment rejects "def myfunc()" 
-- test comment rejects "string = This is my #{string}"
-- string on next test is borrowed from Elixir standard lib
-- test comment rejects "Access.filter/1 expected a list, got: #{inspect(data)}" 


grammar
   attribute_char = "@"
   attribute_name = {[[:alnum:][_.]]}+
   mdoc = attribute_char "moduledoc"
   doc = attribute_char "doc"
   type = attribute_char "type"
   callback = attribute_char "callback"
   specifier = attribute_char "spec"
in
   attribute = {mdoc / doc / type / callback / specifier} / {attribute_char ~ attribute_name}
end
-- test attribute accepts "@doc"
-- test attribute accepts "@moduledoc"
-- test attribute accepts "@tag_test"
-- test attribute rejects "@tag test" -- no spaces allowed!

variable = {[[:alnum:] [_.]]}+
grammar 
   standard_sigils = {"~r"/ci:"~s"/"~c"/"~w"/"~D"/"~U"/"~T"/"~N"}
   custom_sigils = {"~"[:alnum:]+}
in 
   sigil = {standard_sigils / custom_sigils}
end

atom = {!{comment/attribute/sigil} &amp; {":"/[:upper:]+} variable*}
-- test atom accepts "Atom"
-- test atom accepts ":Erlang"
-- test atom accepts ":erlang"
-- test atom rejects "erlang"
-- test atom rejects "1Erlang"
-- test atom rejects "# This is a test atom"
-- test atom rejects "# :erlang"
-- test atom rejects "@tag"
-- test atom rejects "@Tag"
-- test atom rejects "~S\"\"\""

grammar
   dmodule = "defmodule"
   optional_start_delimiter = "do"
in
   module = {^dmodule ~ atom ~ {optional_start_delimiter}?}
end

-- test module accepts "defmodule A do"
-- test module accepts "defmodule A.B"
-- test module accepts "defmodule Zz do"
-- test module accepts "defmodule Z0_9 do"
-- test module rejects "defmodule _ do"
-- test module rejects "defmodule a do"</code></pre>

<p>By the way all this stuff is in the <a href="https://codeberg.org/OldDutchCap/ex_rose">ex_rose repository</a> if you&rsquo;d care to look at it yourself or even contribute to it.</p>

<p>Part of my thinking was beside the ability to use this to search files, it would also allow us to have PEG expressions for Elixir. I believe some folks have started to try to build EBNF for Elixir and I think PEG expressions would also be helpful and make some sense.</p>

<h2 id="whats-that-youre-saying">What&rsquo;s That You&rsquo;re Saying?</h2>

<p>So to explain the Rosie code above a bit. The file starts with some documentation&mdash;the license, my name etc. It also specifies the version of the Rosie Language Engine we&rsquo;re using.</p>

<p>Next is the definition of a comment in Elixir. While this is fairly straight-forward, there&rsquo;s one edge case I&rsquo;ve found so far and I deal with it. That is, saying "#" followed by any string will accidentally treat string interpolation (#{) as a comment as well. So I make sure I specifically treat that case as well. I may build out a doctest construct using my comment pattern but I haven&rsquo;t decided yet.</p>

<p>Next is one of my favorite things about Rosie. Built-in unit tests. As I&rsquo;m working on creating patterns unit tests help me to ensure my refactorings don&rsquo;t accidentally regress anything. Plus, as you may notice, when I find a case that doesn&rsquo;t work, I can add it as a test.</p>

<h2 id="ok-so-how-can-i-use-this">Ok, So How Can I Use This?</h2>

<p>I&rsquo;ve included a couple of quick shell scripts into the repository as well. In the spirit of Unix utilities, they&rsquo;ll output matching text which can then be filtered further to find what you&rsquo;re looking for. I have to admit I&rsquo;m not 100% on the difference between rosie grep and rosie match but that&rsquo;s not really my main concern anyway.</p>

<p>The usual stuff applies&mdash;if you think this is an interesting/worthwhile project please feel free to contribute. If you&rsquo;ve got a lot stronger grasp of correct Elixir syntax please feel free to let me know what I&rsquo;ve gotten wrong.</p>
    <footer>
        <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
        <g:plusone size="medium" href="https://onor.io/2025\08\rosie-and-elixir.html"></g:plusone> <div id="disqus_thread"></div>
                                                                                                   <script type="text/javascript">
                                                                                                     var disqus_config = function () {
                                                                                                       this.page.identifier = undefined;
                                                                                                       this.page.url = undefined;
                                                                                                       this.page.title = undefined;
                                                                                                       this.page.category_id = undefined;
                                                                                                     };
                                                                                                     var disqus_shortname = 'DesultoryNerdery';
                                                                                                     (function() {
                                                                                                         var dsq = document.createElement('script');
                                                                                                         dsq.type = 'text/javascript';
                                                                                                         dsq.async = true;
                                                                                                         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                                                                                                         dsq.setAttribute('data-timestamp', +new Date());
                                                                                                         (document.head || document.body).appendChild(dsq);
                                                                                                     })();
                                                                                                   </script>
                                                                                                   <noscript>
                                                                                                     Please enable JavaScript to view the
                                                                                                     <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
                                                                                                   </noscript>
        <div class="row justify-content-center">
          <nav aria-label="Page Navigation">
            <ul class="pagination">
              <li class="page-item">
                <a class="page-link" href="/2025\07\stop-helping-me-ai.html"
                   aria-label="Previous">
                  <span aria-hidden="true">&larr; Stop Helping Me AI!</span>
                </a>
              </li>

            </ul>
          </nav>
        </div>
        <iframe
            src="https://embeds.beehiiv.com/dc265450-9873-4ff2-a9b7-f4d1182667c8"
            data-test-id="beehiiv-embed"
            width="100%"
            height="320"
            frameborder="0"
            scrolling="no"
            style="
                border-radius: 4px;
                border: 2px solid #e5e7eb;
                margin: 0;
                background-color: transparent;
            "
        ></iframe>
    </footer>
</article>
        </div>
      </div>
      <div id="root"></div>
      <script type="text/babel">
        function App() {
          return (
            <img
              src="https://i.imgur.com/MK3eW3Am.jpg"
              alt="Katherine Johnson"
            />
          );
        }
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
      </script>

      <footer>
        <hr />
        <p>Site generated
        by <a href="https://github.com/greghendershott/frog">Frog</a>,
        the <strong>fr</strong>ozen bl<strong>og</strong> tool.</p>
        <p>Using <a href="http://twitter.github.com/bootstrap/index.html">Bootstrap</a>.</p>
        <p><em>Copyright 2024 By Onorio Catenacci</em>.</p>
      </footer>
    </div>
    <!-- </body> JS -->
    <script type="text/javascript" src="/js/jquery-3.2.1.slim.min.js"></script>
    <script type="text/javascript" src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/react.development.js"></script>
    <script src="/js/react-dom.development.js"></script>
    <!-- Load our React component. -->
<!--    <script type="text/javascript" src="/js/index.js"></script> -->
  </body>
</html>